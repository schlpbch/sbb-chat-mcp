/snap/google-cloud-sdk/632/lib/third_party/google/cloud/__init__.py:20: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
--------------------------- REMOTE BUILD OUTPUT ---------------------------
starting build "67ae2da0-a7e4-48e0-85a1-4629667228cc"
FETCHSOURCE
From https://github.com/schlpbch/sbb-chat-mcp
 * branch            e5c692908a729cce36b9bb83a9e179d155b45b7c -> FETCH_HEAD
HEAD is now at e5c6929 deps: update various dependencies including `@google-cloud/text-to-speech`, `zod`, `eslint`, `typescript`, and add `@storybook/react`.
GitCommit:
e5c692908a729cce36b9bb83a9e179d155b45b7c
BUILD
Starting Step #0
Step #0: Pulling image: node:24
Step #0: 24: Pulling from library/node
Step #0: 32a5bf163bd7: Pulling fs layer
Step #0: 16afb0fdc469: Pulling fs layer
Step #0: a858b7813255: Pulling fs layer
Step #0: 318d61060ae7: Pulling fs layer
Step #0: 6769697eada3: Pulling fs layer
Step #0: b1efb0d4c2fc: Pulling fs layer
Step #0: 78f181c72d3b: Pulling fs layer
Step #0: ddb1ace0249d: Pulling fs layer
Step #0: 78f181c72d3b: Waiting
Step #0: ddb1ace0249d: Waiting
Step #0: 6769697eada3: Download complete
Step #0: 16afb0fdc469: Verifying Checksum
Step #0: 16afb0fdc469: Download complete
Step #0: 78f181c72d3b: Download complete
Step #0: 32a5bf163bd7: Verifying Checksum
Step #0: 32a5bf163bd7: Download complete
Step #0: ddb1ace0249d: Verifying Checksum
Step #0: ddb1ace0249d: Download complete
Step #0: b1efb0d4c2fc: Verifying Checksum
Step #0: b1efb0d4c2fc: Download complete
Step #0: a858b7813255: Verifying Checksum
Step #0: a858b7813255: Download complete
Step #0: 318d61060ae7: Verifying Checksum
Step #0: 318d61060ae7: Download complete
Step #0: 32a5bf163bd7: Pull complete
Step #0: 16afb0fdc469: Pull complete
Step #0: a858b7813255: Pull complete
Step #0: 318d61060ae7: Pull complete
Step #0: 6769697eada3: Pull complete
Step #0: b1efb0d4c2fc: Pull complete
Step #0: 78f181c72d3b: Pull complete
Step #0: ddb1ace0249d: Pull complete
Step #0: Digest: sha256:b52a8d1206132b36d60e51e413d9a81336e8a0206d3b648cabd6d5a49c4c0f54
Step #0: Status: Downloaded newer image for node:24
Step #0: docker.io/library/node:24
Step #0: Preparing pnpm@latest for immediate activation...
Step #0: Lockfile is up to date, resolution step is skipped
Step #0: Progress: resolved 1, reused 0, downloaded 0, added 0
Step #0: Packages: +763
Step #0: ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Step #0: Progress: resolved 763, reused 0, downloaded 169, added 164
Step #0: Progress: resolved 763, reused 0, downloaded 360, added 360
Step #0: Progress: resolved 763, reused 0, downloaded 626, added 624
Step #0: Progress: resolved 763, reused 0, downloaded 763, added 763, done
Step #0:
Step #0: dependencies:
Step #0: + - 0.0.1
Step #0: + @google-cloud/text-to-speech 6.4.0
Step #0: + @google-cloud/translate 9.3.0
Step #0: + @google/generative-ai 0.24.1
Step #0: + @types/leaflet 1.9.21
Step #0: + @types/mdast 4.0.4
Step #0: + leaflet 1.9.4
Step #0: + lucide-react 0.562.0
Step #0: + next 16.1.1
Step #0: + react 19.2.3
Step #0: + react-dom 19.2.3
Step #0: + react-markdown 10.1.0
Step #0: + remark-gfm 4.0.1
Step #0: + remark-parse 11.0.0
Step #0: + resend 6.6.0
Step #0: + unified 11.0.5
Step #0: + unist-util-visit 5.0.0
Step #0: + zod 4.3.4
Step #0:
Step #0: devDependencies:
Step #0: + @chromatic-com/storybook 4.1.3
Step #0: + @playwright/test 1.57.0
Step #0: + @storybook/addon-a11y 10.1.11
Step #0: + @storybook/addon-docs 10.1.11
Step #0: + @storybook/addon-onboarding 10.1.11
Step #0: + @storybook/addon-themes 10.1.11
Step #0: + @storybook/addon-vitest 10.1.11
Step #0: + @storybook/nextjs-vite 10.1.11
Step #0: + @storybook/react 10.1.11
Step #0: + @tailwindcss/postcss 4.1.18
Step #0: + @testing-library/jest-dom 6.9.1
Step #0: + @testing-library/react 16.3.1
Step #0: + @testing-library/user-event 14.6.1
Step #0: + @types/node 25.0.3
Step #0: + @types/react 19.2.7
Step #0: + @types/react-dom 19.2.3
Step #0: + @vitejs/plugin-react 5.1.2
Step #0: + @vitest/browser-playwright 4.0.16
Step #0: + @vitest/coverage-v8 4.0.16
Step #0: + eslint 9.39.2
Step #0: + eslint-config-next 16.1.1
Step #0: + eslint-plugin-storybook 10.1.11
Step #0: + jsdom 27.4.0
Step #0: + playwright 1.57.0
Step #0: + storybook 10.1.11
Step #0: + tailwindcss 4.1.18
Step #0: + tsc 2.0.4
Step #0: + typescript 5.9.3
Step #0: + vite 7.3.0
Step #0: + vitest 4.0.16
Step #0:
Step #0: ╭ Warning ─────────────────────────────────────────────────────────────────────╮
Step #0: │                                                                              │
Step #0: │   Ignored build scripts: esbuild@0.27.2, protobufjs@7.5.4.                   │
Step #0: │   Run "pnpm approve-builds" to pick which dependencies should be allowed     │
Step #0: │   to run scripts.                                                            │
Step #0: │                                                                              │
Step #0: ╰──────────────────────────────────────────────────────────────────────────────╯
Step #0: Done in 4.4s using pnpm v10.27.0
Step #0:
Step #0: > sbb-travel-companion@0.9.0 lint /workspace
Step #0: > eslint
Step #0:
Step #0:
Step #0: /workspace/.storybook/preview.tsx
Step #0:   13:3   error  Use "@ts-expect-error" instead of "@ts-ignore", as "@ts-ignore" will do nothing if the following line is error-free  @typescript-eslint/ban-ts-comment
Step #0:   22:31  error  Unexpected any. Specify a different type                                                                             @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/eslint.config.mjs
Step #0:   2:8  warning  'storybook' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/__tests__/lib/mapUtils.test.ts
Step #0:    6:5  error  Use "@ts-expect-error" instead of "@ts-ignore", as "@ts-ignore" will do nothing if the following line is error-free  @typescript-eslint/ban-ts-comment
Step #0:   11:5  error  Use "@ts-expect-error" instead of "@ts-ignore", as "@ts-ignore" will do nothing if the following line is error-free  @typescript-eslint/ban-ts-comment
Step #0:   30:5  error  Use "@ts-expect-error" instead of "@ts-ignore", as "@ts-ignore" will do nothing if the following line is error-free  @typescript-eslint/ban-ts-comment
Step #0:   48:5  error  Use "@ts-expect-error" instead of "@ts-ignore", as "@ts-ignore" will do nothing if the following line is error-free  @typescript-eslint/ban-ts-comment
Step #0:   88:5  error  Use "@ts-expect-error" instead of "@ts-ignore", as "@ts-ignore" will do nothing if the following line is error-free  @typescript-eslint/ban-ts-comment
Step #0:
Step #0: /workspace/src/app/api/mcp-proxy/prompts/[name]/route.ts
Step #0:    63:38  error  Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:    80:9   error  Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:    82:20  error  Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:   136:17  error  'shouldRetry' is never reassigned. Use 'const' instead  prefer-const
Step #0:
Step #0: /workspace/src/app/api/mcp-proxy/resources/read/route.ts
Step #0:    87:38  error  Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:   108:20  error  Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:   170:17  error  'shouldRetry' is never reassigned. Use 'const' instead  prefer-const
Step #0:
Step #0: /workspace/src/app/api/mcp-proxy/tools/[name]/route.ts
Step #0:    79:38  error    Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:   100:9   error    Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:   102:20  error    Unexpected any. Specify a different type                @typescript-eslint/no-explicit-any
Step #0:   158:17  error    'shouldRetry' is never reassigned. Use 'const' instead  prefer-const
Step #0:   188:18  warning  'e' is defined but never used                           @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/app/chat/page.tsx
Step #0:   36:10  warning  'mounted' is assigned a value but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @typescript-eslint/no-unused-vars
Step #0:   43:5   warning  'toolsExecuting' is assigned a value but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      @typescript-eslint/no-unused-vars
Step #0:   76:5   error    Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/app/chat/page.tsx:76:5
Step #0:   74 |   // Set mounted state to prevent hydration mismatch
Step #0:   75 |   useEffect(() => {
Step #0: > 76 |     setMounted(true);
Step #0:      |     ^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   77 |   }, []);
Step #0:   78 |
Step #0:   79 |   // Handle query parameter for pre-filled queries  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/app/health/page.tsx
Step #0:    16:31  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:    18:15  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:    19:17  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:    20:19  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:   138:9   warning  'getStatusBg' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:   501:34  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:   575:36  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:   596:47  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:   656:38  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:   716:51  error    Unexpected any. Specify a different type          @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/app/map/page.tsx
Step #0:   3:20  warning  'useEffect' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/app/mcp-test/page.tsx
Step #0:    15:32  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    51:9   warning  't' is assigned a value but never used    @typescript-eslint/no-unused-vars
Step #0:   360:70  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/app/privacy/page.tsx
Step #0:    25:37  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:    25:40  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:    25:43  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:    25:47  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:    25:53  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:    25:56  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:   100:33  error  `'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`                                                                                        react/no-unescaped-entities
Step #0:   167:21  error  `'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`                                                                                        react/no-unescaped-entities
Step #0:   181:48  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:   181:61  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:   197:11  error  Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages  @next/next/no-html-link-for-pages
Step #0:
Step #0: /workspace/src/app/prompts/[name]/page.tsx
Step #0:   31:55  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   32:40  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   36:9   warning  't' is assigned a value but never used    @typescript-eslint/no-unused-vars
Step #0:   58:49  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   67:16  warning  'err' is defined but never used           @typescript-eslint/no-unused-vars
Step #0:   76:50  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   89:13  warning  '_' is defined but never used             @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/app/resources/[uri]/page.tsx
Step #0:    27:41  error    Unexpected any. Specify a different type                         @typescript-eslint/no-explicit-any
Step #0:    31:8   warning  't' is assigned a value but never used                           @typescript-eslint/no-unused-vars
Step #0:    55:11  warning  'err' is defined but never used                                  @typescript-eslint/no-unused-vars
Step #0:    83:11  warning  'parseError' is defined but never used                           @typescript-eslint/no-unused-vars
Step #0:   225:8   error    `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   225:23  error    `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:
Step #0: /workspace/src/app/settings/page.tsx
Step #0:   30:7  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/app/settings/page.tsx:30:7
Step #0:   28 |     const savedUrl = localStorage.getItem('mcpServerUrl');
Step #0:   29 |     if (savedUrl) {
Step #0: > 30 |       setMcpServerUrl(savedUrl);
Step #0:      |       ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   31 |     }
Step #0:   32 |
Step #0:   33 |   }, []);  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/app/share/page.tsx
Step #0:    46:13  error  Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages  @next/next/no-html-link-for-pages
Step #0:   135:13  error  Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages  @next/next/no-html-link-for-pages
Step #0:
Step #0: /workspace/src/app/terms/page.tsx
Step #0:   135:38  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:   135:44  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`                                                                                        react/no-unescaped-entities
Step #0:   168:52  error  `'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`                                                                                        react/no-unescaped-entities
Step #0:   233:11  error  Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages  @next/next/no-html-link-for-pages
Step #0:
Step #0: /workspace/src/app/tools/[name]/page.tsx
Step #0:    16:29  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    31:54  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    32:39  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    36:8   warning  't' is assigned a value but never used    @typescript-eslint/no-unused-vars
Step #0:    58:38  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    69:11  warning  'err' is defined but never used           @typescript-eslint/no-unused-vars
Step #0:    78:49  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    90:34  warning  '_' is defined but never used             @typescript-eslint/no-unused-vars
Step #0:   182:27  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/ExampleQueryCard.tsx
Step #0:   33:31  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/Map.tsx
Step #0:    7:11  error  An empty interface declaration allows any non-nullish value, including literals like `0` and `""`.
Step #0: - If that's what you want, disable this lint rule with an inline comment or configure the 'allowInterfaces' rule option.
Step #0: - If you want a type meaning "any object", you probably want `object` instead.
Step #0: - If you want a type meaning "any value", you probably want `unknown` instead  @typescript-eslint/no-empty-object-type
Step #0:   62:35  error  Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/Navbar.tsx
Step #0:   49:7  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/components/Navbar.tsx:49:7
Step #0:   47 |     console.log('[Navbar] Theme changed:', theme);
Step #0:   48 |     if (theme === 'dark') {
Step #0: > 49 |       setIsDark(true);
Step #0:      |       ^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   50 |     } else if (theme === 'light') {
Step #0:   51 |       setIsDark(false);
Step #0:   52 |     } else if (theme === 'system') {  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/components/cards/BoardCard.tsx
Step #0:   43:60  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/cards/CompareCard.tsx
Step #0:     3:10  warning  'useState' is defined but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @typescript-eslint/no-unused-vars
Step #0:     7:3   warning  'formatTime' is defined but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          @typescript-eslint/no-unused-vars
Step #0:    18:3   warning  'Leaf' is defined but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @typescript-eslint/no-unused-vars
Step #0:    19:3   warning  'Ticket' is defined but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              @typescript-eslint/no-unused-vars
Step #0:    20:3   warning  'Info' is defined but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @typescript-eslint/no-unused-vars
Step #0:    91:19  error    Error: Cannot create components during render
Step #0:
Step #0: Components created during render will reset their state each time they are created. Declare components outside of render.
Step #0:
Step #0: /workspace/src/components/cards/CompareCard.tsx:91:19
Step #0:   89 |         icon={(() => {
Step #0:   90 |           const IconComponent = getCriteriaIcon(criteria);
Step #0: > 91 |           return <IconComponent className="w-5 h-5" strokeWidth={2} />;
Step #0:      |                   ^^^^^^^^^^^^^ This component is created during render
Step #0:   92 |         })()}
Step #0:   93 |         title={getCriteriaLabel(criteria)}
Step #0:   94 |         subtitle={`${origin} → ${destination}`}
Step #0:
Step #0: /workspace/src/components/cards/CompareCard.tsx:90:33
Step #0:   88 |       <CardHeader
Step #0:   89 |         icon={(() => {
Step #0: > 90 |           const IconComponent = getCriteriaIcon(criteria);
Step #0:      |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^ The component is created during render here
Step #0:   91 |           return <IconComponent className="w-5 h-5" strokeWidth={2} />;
Step #0:   92 |         })()}
Step #0:   93 |         title={getCriteriaLabel(criteria)}  react-hooks/static-components
Step #0:   135:17  warning  'pricePercent' is assigned a value but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               @typescript-eslint/no-unused-vars
Step #0:   322:30  error    Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @typescript-eslint/no-explicit-any
Step #0:   331:29  error    Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @typescript-eslint/no-explicit-any
Step #0:   331:53  error    Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @typescript-eslint/no-explicit-any
Step #0:   333:32  error    Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @typescript-eslint/no-explicit-any
Step #0:   341:32  error    Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/cards/FormationCard.tsx
Step #0:    7:9   error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   54:34  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   64:91  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   67:95  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   68:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   69:60  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/cards/ItineraryCard.tsx
Step #0:    6:3  warning  'MapPin' is defined but never used           @typescript-eslint/no-unused-vars
Step #0:    7:3  warning  'UtensilsCrossed' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:    8:3  warning  'Landmark' is defined but never used         @typescript-eslint/no-unused-vars
Step #0:    9:3  warning  'TreePine' is defined but never used         @typescript-eslint/no-unused-vars
Step #0:   10:3  warning  'ShoppingBag' is defined but never used      @typescript-eslint/no-unused-vars
Step #0:   11:3  warning  'Hotel' is defined but never used            @typescript-eslint/no-unused-vars
Step #0:   12:3  warning  'Train' is defined but never used            @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/cards/MarkdownCard.tsx
Step #0:    64:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    72:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    80:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    88:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    98:19  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   108:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   116:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   124:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   127:19  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   141:22  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   141:48  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   163:21  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   173:28  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   185:23  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   193:23  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   201:23  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   209:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   210:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   218:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   228:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   240:24  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   250:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/cards/SnowCard.tsx
Step #0:   10:9  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/cards/StationCard.tsx
Step #0:   8:17  warning  'Accessibility' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:   8:32  warning  'Footprints' is defined but never used     @typescript-eslint/no-unused-vars
Step #0:   8:44  warning  'ArrowUpDown' is defined but never used    @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/cards/TripCard.tsx
Step #0:    17:9   error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:    30:29  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   104:39  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   107:38  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   494:31  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   501:23  warning  'isWalk' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:   578:29  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   579:21  warning  'isWalk' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:   636:44  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   681:41  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   682:38  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/cards/WeatherCard.tsx
Step #0:    24:9   warning  'visibility' is assigned a value but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  @typescript-eslint/no-unused-vars
Step #0:    92:14  error    Error: Cannot create components during render
Step #0:
Step #0: Components created during render will reset their state each time they are created. Declare components outside of render.
Step #0:
Step #0: /workspace/src/components/cards/WeatherCard.tsx:92:14
Step #0:   90 |         rightContent={
Step #0:   91 |           <div className="w-10 h-10 rounded-xl bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center">
Step #0: > 92 |             <WeatherIcon
Step #0:      |              ^^^^^^^^^^^ This component is created during render
Step #0:   93 |               className="w-6 h-6 text-yellow-600 dark:text-yellow-400"
Step #0:   94 |               strokeWidth={2}
Step #0:   95 |             />
Step #0:
Step #0: /workspace/src/components/cards/WeatherCard.tsx:57:23
Step #0:   55 |
Step #0:   56 |   // Get icon components
Step #0: > 57 |   const WeatherIcon = getWeatherIcon(condition);
Step #0:      |                       ^^^^^^^^^^^^^^^^^^^^^^^^^ The component is created during render here
Step #0:   58 |   const ThermometerIcon = utilityIcons.thermometer;
Step #0:   59 |   const DropletIcon = utilityIcons.droplet;
Step #0:   60 |   const WindIcon = utilityIcons.wind;  react-hooks/static-components
Step #0:   224:35  error    Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/chat/ChatInput.tsx
Step #0:   14:10  warning  'isListening' is assigned a value but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       @typescript-eslint/no-unused-vars
Step #0:   24:9   error    Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/components/chat/ChatInput.tsx:24:9
Step #0:   22 |         window.SpeechRecognition || window.webkitSpeechRecognition;
Step #0:   23 |       if (SpeechRecognitionAPI) {
Step #0: > 24 |         setSpeechSupported(true);
Step #0:      |         ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   25 |         const recognition = new SpeechRecognitionAPI();
Step #0:   26 |         recognition.continuous = true;
Step #0:   27 |         recognition.interimResults = true;  react-hooks/set-state-in-effect
Step #0:   43:15  warning  'interimTranscript' is assigned a value but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/chat/ChatMessage.tsx
Step #0:   14:9  warning  't' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/chat/StreamingChatMessage.tsx
Step #0:   16:8  warning  'MarkdownCard' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/chat/StreamingMarkdownCard.tsx
Step #0:    73:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    81:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    89:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:    97:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   107:19  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   117:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   125:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   133:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   136:19  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   150:22  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   150:48  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   172:21  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   182:28  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   194:23  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   202:23  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   210:23  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   218:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   219:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   227:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   237:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   249:24  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:   259:20  warning  'node' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/chat/StreamingToolResults.tsx
Step #0:    15:10  warning  'translations' is defined but never used                                                                                                           @typescript-eslint/no-unused-vars
Step #0:    85:3   warning  'language' is defined but never used                                                                                                               @typescript-eslint/no-unused-vars
Step #0:   251:54  error    Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   263:51  error    Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   273:35  error    Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   289:50  error    Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   339:37  error    React Hook "useMemo" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function  react-hooks/rules-of-hooks
Step #0:   374:33  error    Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   384:33  error    Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/chat/TTSControls.tsx
Step #0:    3:19  warning  'VolumeX' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:   27:3   warning  'onStop' is defined but never used   @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/components/chat/ToolResults.tsx
Step #0:    19:11  error  Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:    20:11  error  Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:    46:28  error  React Hook "useMemo" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function  react-hooks/rules-of-hooks
Step #0:   112:25  error  React Hook "useMemo" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function  react-hooks/rules-of-hooks
Step #0:   147:49  error  Unexpected any. Specify a different type                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   212:35  error  React Hook "useMemo" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function  react-hooks/rules-of-hooks
Step #0:
Step #0: /workspace/src/components/landing/FeaturedExamples.tsx
Step #0:   19:49  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/components/landing/HeroSection.tsx
Step #0:   23:5  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/components/landing/HeroSection.tsx:23:5
Step #0:   21 |   // Set mounted state first
Step #0:   22 |   useEffect(() => {
Step #0: > 23 |     setMounted(true);
Step #0:      |     ^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   24 |   }, []);
Step #0:   25 |
Step #0:   26 |   // Load recent searches only after mounted                                             react-hooks/set-state-in-effect
Step #0:   41:9  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/components/landing/HeroSection.tsx:41:9
Step #0:   39 |             )
Step #0:   40 |           : [];
Step #0: > 41 |         setRecentSearches(normalized);
Step #0:      |         ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   42 |       } catch (e) {
Step #0:   43 |         console.error('Failed to load recent searches:', e);
Step #0:   44 |       }  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/components/onboarding/OnboardingModal.tsx
Step #0:   67:23  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   67:47  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   71:23  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   71:47  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   75:23  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   75:47  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:
Step #0: /workspace/src/context/SettingsContext.tsx
Step #0:   33:9  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/context/SettingsContext.tsx:33:9
Step #0:   31 |     if (saved) {
Step #0:   32 |       try {
Step #0: > 33 |         setSettings({ ...defaultSettings, ...JSON.parse(saved) });
Step #0:      |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   34 |       } catch (e) {
Step #0:   35 |         console.error('Failed to parse settings', e);
Step #0:   36 |       }  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/hooks/useChat.ts
Step #0:    15:13  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    16:13  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   147:51  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/hooks/useChatStorage.ts
Step #0:   24:52  error  Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           @typescript-eslint/no-explicit-any
Step #0:   28:9   error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/hooks/useChatStorage.ts:28:9
Step #0:   26 |           timestamp: new Date(msg.timestamp)
Step #0:   27 |         }));
Step #0: > 28 |         setMessages(messagesWithDates);
Step #0:      |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   29 |       }
Step #0:   30 |     } catch (error) {
Step #0:   31 |       logger.error('useChatStorage', 'Error loading chat history', error);  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/hooks/useFavoriteStations.ts
Step #0:   25:11  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/hooks/useFavoriteStations.ts:25:11
Step #0:   23 |         const parsed = JSON.parse(saved);
Step #0:   24 |         if (Array.isArray(parsed)) {
Step #0: > 25 |           setFavorites(parsed);
Step #0:      |           ^^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   26 |         }
Step #0:   27 |       } catch (e) {
Step #0:   28 |         console.error('Failed to parse favorites', e);  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/hooks/useRecentSearches.ts
Step #0:   24:11  error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/hooks/useRecentSearches.ts:24:11
Step #0:   22 |         const parsed = JSON.parse(saved);
Step #0:   23 |         if (Array.isArray(parsed)) {
Step #0: > 24 |           setRecent(parsed);
Step #0:      |           ^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   25 |         }
Step #0:   26 |       } catch (e) {
Step #0:   27 |         console.error('Failed to parse recent searches', e);  react-hooks/set-state-in-effect
Step #0:
Step #0: /workspace/src/hooks/useSavedTrips.ts
Step #0:    9:18  error  Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @typescript-eslint/no-explicit-any
Step #0:   23:9   error  Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/hooks/useSavedTrips.ts:23:9
Step #0:   21 |     if (saved) {
Step #0:   22 |       try {
Step #0: > 23 |         setSavedTrips(JSON.parse(saved));
Step #0:      |         ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   24 |       } catch (e) {
Step #0:   25 |         console.error('Failed to parse saved trips', e);
Step #0:   26 |       }  react-hooks/set-state-in-effect
Step #0:   42:57  error  Unexpected any. Specify a different type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/hooks/useStreamingChat.ts
Step #0:    34:32  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   187:32  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/hooks/useVoiceInput.ts
Step #0:   25:7   error    Error: Calling setState synchronously within an effect can trigger cascading renders
Step #0:
Step #0: Effects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:
Step #0: * Update external systems with the latest state from React.
Step #0: * Subscribe for updates from some external system, calling setState in a callback function when external state changes.
Step #0:
Step #0: Calling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).
Step #0:
Step #0: /workspace/src/hooks/useVoiceInput.ts:25:7
Step #0:   23 |     // Check browser support
Step #0:   24 |     if (typeof window === 'undefined') {
Step #0: > 25 |       setIsSupported(false);
Step #0:      |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect
Step #0:   26 |       return;
Step #0:   27 |     }
Step #0:   28 |  react-hooks/set-state-in-effect
Step #0:   59:18  warning  'e' is defined but never used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  @typescript-eslint/no-unused-vars
Step #0:   64:6   warning  React Hook useEffect has a missing dependency: 'langMap'. Either include it or remove the dependency array                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     react-hooks/exhaustive-deps
Step #0:
Step #0: /workspace/src/lib/__tests__/formatters.test.ts
Step #0:   145:38  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/__tests__/i18n.test.ts
Step #0:   69:56  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/cache.ts
Step #0:   106:42  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   107:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   108:42  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/formatters.ts
Step #0:   50:49  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/intentParser.ts
Step #0:     4:21  warning  'Heading' is defined but never used       @typescript-eslint/no-unused-vars
Step #0:     4:30  warning  'List' is defined but never used          @typescript-eslint/no-unused-vars
Step #0:     4:36  warning  'Strong' is defined but never used        @typescript-eslint/no-unused-vars
Step #0:     4:44  warning  'Emphasis' is defined but never used      @typescript-eslint/no-unused-vars
Step #0:     4:54  warning  'InlineCode' is defined but never used    @typescript-eslint/no-unused-vars
Step #0:    60:27  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    66:21  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    93:28  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   231:3   warning  'headings' is defined but never used      @typescript-eslint/no-unused-vars
Step #0:   232:3   warning  'lists' is defined but never used         @typescript-eslint/no-unused-vars
Step #0:   233:3   warning  'tables' is defined but never used        @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/lib/llm/__tests__/retryHandler.test.ts
Step #0:   451:17  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/chatModes/modelFactory.ts
Step #0:   14:22  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/chatModes/streamingChatMode.ts
Step #0:   20:19  error    Unexpected any. Specify a different type             @typescript-eslint/no-explicit-any
Step #0:   22:11  warning  'sessionContext' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/lib/llm/context/cacheManager.ts
Step #0:    5:53  warning  'MentionedEntity' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:   20:11  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   21:11  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   60:11  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   76:58  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/context/intentExtractor.ts
Step #0:    12:10  warning  'INTENT_KEYWORDS' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:   171:19  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   172:34  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:   311:28  error    Unexpected any. Specify a different type     @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/context/types.ts
Step #0:   102:9  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/orchestrator/planFactory.ts
Step #0:   110:69  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   113:65  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/orchestrator/resultFormatter.ts
Step #0:   12:3   warning  'language' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:   19:42  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   19:90  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   23:44  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   23:73  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   24:20  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   25:23  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   47:39  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/orchestrator/services/ContextPreparationService.ts
Step #0:   32:20  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   38:70  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/orchestrator/services/PlanCoordinatorService.ts
Step #0:   17:26  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   18:11  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts
Step #0:    78:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    79:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   101:62  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   115:67  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   154:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   155:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   186:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   187:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   233:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   234:66  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   271:68  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   272:68  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/orchestrator/services/__tests__/ResponseSynthesisService.test.ts
Step #0:    29:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    56:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    78:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   100:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   120:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   137:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   160:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   186:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   203:59  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   209:22  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/prompts/__tests__/PromptLoader.test.ts
Step #0:    49:58  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    93:63  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   116:50  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   137:12  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   147:12  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   158:12  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/toolExecutor.ts
Step #0:    85:24  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   154:21  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   165:20  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   181:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   182:27  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/llm/toolResolvers/LocationResolver.ts
Step #0:   94:19  warning  'location' is assigned a value but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts
Step #0:    12:32  warning  'params' is defined but never used        @typescript-eslint/no-unused-vars
Step #0:    18:5   warning  'executeTool' is defined but never used   @typescript-eslint/no-unused-vars
Step #0:    18:41  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:    18:57  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   136:47  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   136:63  error    Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/mapUtils.ts
Step #0:   70:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   71:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   72:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   73:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   79:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   80:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   81:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:   82:39  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/normalizers/__tests__/cardData.test.ts
Step #0:   1:32  warning  'beforeEach' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:
Step #0: /workspace/src/lib/normalizers/cardData.ts
Step #0:    10:3   warning  'compareDataSchema' is defined but never used  @typescript-eslint/no-unused-vars
Step #0:    16:8   warning  'CompareData' is defined but never used        @typescript-eslint/no-unused-vars
Step #0:   166:38  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   192:48  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   194:38  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:   256:21  error    Unexpected any. Specify a different type       @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/lib/tts/contentProcessor.ts
Step #0:   17:22  error  Unexpected any. Specify a different type  @typescript-eslint/no-explicit-any
Step #0:
Step #0: /workspace/src/stories/Page.tsx
Step #0:   39:13  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:   39:18  error  `"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`  react/no-unescaped-entities
Step #0:
Step #0: /workspace/src/test/setup.ts
Step #0:   8:16  error  A `require()` style import is forbidden  @typescript-eslint/no-require-imports
Step #0:   9:18  error  A `require()` style import is forbidden  @typescript-eslint/no-require-imports
Step #0:
Step #0: /workspace/src/types/speech-recognition.d.ts
Step #0:   65:1  error  Unexpected var, use let or const instead  no-var
Step #0:
Step #0: /workspace/tailwind.config.js
Step #0:   2:1  warning  Assign object to a variable before exporting as module default  import/no-anonymous-default-export
Step #0:
Step #0: ✖ 323 problems (217 errors, 106 warnings)
Step #0:
Step #0:  ELIFECYCLE  Command failed with exit code 1.
Step #0:
Step #0: > sbb-travel-companion@0.9.0 test:unit /workspace
Step #0: > vitest
Step #0:
Step #0:
Step #0: [1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/workspace[39m
Step #0:
Step #0:  [32m✓[39m src/lib/utils/__tests__/TimeParser.test.ts [2m([22m[2m55 tests[22m[2m)[22m[32m 20[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould return success on first attempt
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: {
Step #0:   error: [32m'Temporary network failure'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-service: { error: [32m'Still failing network'[39m, code: [90mundefined[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Attempt 2/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Retrying in 20ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould succeed after retries
Step #0: [22m[39m[RetryHandler] Attempt 3/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Success Cases[2m > [22m[2mshould measure total duration
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: {
Step #0:   error: [32m'Persistent network failure'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0:  [32m✓[39m src/lib/llm/__tests__/rateLimiter.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 38[2mms[22m[39m
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-service: {
Step #0:   error: [32m'Persistent network failure'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Attempt 2/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Retrying in 19ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Attempt 3/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould not retry non-retryable errors
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 429 (rate limit)
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 429 (rate limit)
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould fail after max attempts
Step #0: [22m[39m[RetryHandler] Attempt 3 failed for test-service: {
Step #0:   error: [32m'Persistent network failure'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould not retry non-retryable errors
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: { error: [32m'Bad request'[39m, code: [90mundefined[39m, status: [33m400[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 429 (rate limit)
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: { error: [32m'Rate limited'[39m, code: [90mundefined[39m, status: [33m429[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 429 (rate limit)
Step #0: [22m[39m[RetryHandler] Attempt 2/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 500
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 500
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: { error: [32m'Internal server error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 500
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mcoordinates successful plan execution
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m1[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: { from: [32m'Zurich'[39m, to: [32m'Bern'[39m }
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [ { name: [32m'findTrips'[39m, hasData: [33mtrue[39m } ]
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mreturns null when no plan is created
Step #0: [22m[39m[PlanCoordinatorService] No execution plan created
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 500
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-502
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-502: { error: [32m'Gateway error'[39m, code: [90mundefined[39m, status: [33m502[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mreturns null when plan has no steps
Step #0: [22m[39m[PlanCoordinatorService] No execution plan created
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mfilters out failed tool calls
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m2[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: {}
Step #0:   },
Step #0:   {
Step #0:     toolName: [32m'getWeather'[39m,
Step #0:     success: [33mfalse[39m,
Step #0:     error: [32m'Failed to fetch weather'[39m,
Step #0:     params: {}
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [ { name: [32m'findTrips'[39m, hasData: [33mtrue[39m } ]
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mfilters out tool calls without data
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m1[39m
Step #0: [PlanCoordinatorService] Plan results: [ { toolName: [32m'findTrips'[39m, success: [33mtrue[39m, data: [1mnull[22m, params: {} } ]
Step #0: [PlanCoordinatorService] Filtered tool calls: []
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mhandles multiple successful tool calls
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m3[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: {}
Step #0:   },
Step #0:   {
Step #0:     toolName: [32m'getWeather'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { temperature: [33m20[39m },
Step #0:     params: {}
Step #0:   },
Step #0:   {
Step #0:     toolName: [32m'getPlaceEvents'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { events: [] },
Step #0:     params: {}
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [
Step #0:   { name: [32m'findTrips'[39m, hasData: [33mtrue[39m },
Step #0:   { name: [32m'getWeather'[39m, hasData: [33mtrue[39m },
Step #0:   { name: [32m'getPlaceEvents'[39m, hasData: [33mtrue[39m }
Step #0: ]
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mhandles different languages
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m1[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: {}
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [ { name: [32m'findTrips'[39m, hasData: [33mtrue[39m } ]
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mhandles different languages
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m1[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: {}
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [ { name: [32m'findTrips'[39m, hasData: [33mtrue[39m } ]
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mhandles different languages
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m1[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: {}
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [ { name: [32m'findTrips'[39m, hasData: [33mtrue[39m } ]
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts[2m > [22m[2mPlanCoordinatorService[2m > [22m[2mcoordinatePlan[2m > [22m[2mhandles different languages
Step #0: [22m[39m[PlanCoordinatorService] Plan execution completed. Success: [33mtrue[39m
Step #0: [PlanCoordinatorService] Number of results: [33m1[39m
Step #0: [PlanCoordinatorService] Plan results: [
Step #0:   {
Step #0:     toolName: [32m'findTrips'[39m,
Step #0:     success: [33mtrue[39m,
Step #0:     data: { trips: [] },
Step #0:     params: {}
Step #0:   }
Step #0: ]
Step #0: [PlanCoordinatorService] Filtered tool calls: [ { name: [32m'findTrips'[39m, hasData: [33mtrue[39m } ]
Step #0:
Step #0:  [32m✓[39m src/lib/llm/orchestrator/services/__tests__/PlanCoordinatorService.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 21[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-502
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-503
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-503: { error: [32m'Gateway error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-503
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-504
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-504: { error: [32m'Gateway error'[39m, code: [90mundefined[39m, status: [33m504[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-ECONNRESET: { error: [32m'Network error'[39m, code: [32m'ECONNRESET'[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on HTTP 502, 503, 504
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-504
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-ECONNRESET
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-ECONNRESET
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-ETIMEDOUT
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-ETIMEDOUT: { error: [32m'Network error'[39m, code: [32m'ETIMEDOUT'[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-ENOTFOUND: { error: [32m'Network error'[39m, code: [32m'ENOTFOUND'[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-ETIMEDOUT
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-ENOTFOUND
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-ENOTFOUND
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-ECONNREFUSED
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-ECONNREFUSED: { error: [32m'Network error'[39m, code: [32m'ECONNREFUSED'[39m, status: [90mundefined[39m }
Step #0:
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeBoardData[2m > [22m[2mnormalizes basic departures data
Step #0: [22m[39m=== RAW BOARD DATA === {
Step #0:   "station": "Zurich HB",
Step #0:   "type": "departures",
Step #0:   "connections": [
Step #0:     {
Step #0:       "time": "2024-01-15T14:30:00Z",
Step #0:       "destination": "Bern",
Step #0:       "platform": "7",
Step #0:       "line": "IC 1"
Step #0:     }
Step #0:   ]
Step #0: }
Step #0: === BOARD DATA FIELDS === {
Step #0:   hasStation: [33mtrue[39m,
Step #0:   hasStationName: [33mfalse[39m,
Step #0:   hasPlace: [33mfalse[39m,
Step #0:   hasStopPlace: [33mfalse[39m,
Step #0:   placeName: [90mundefined[39m,
Step #0:   stopPlaceName: [90mundefined[39m,
Step #0:   allKeys: [ [32m'type'[39m, [32m'station'[39m, [32m'connections'[39m ]
Step #0: }
Step #0: === NORMALIZED BOARD DATA === {
Step #0:   type: [32m'departures'[39m,
Step #0:   station: [32m'Zurich HB'[39m,
Step #0:   connectionCount: [33m1[39m,
Step #0:   firstConnection: {
Step #0:     time: [32m'2024-01-15T14:30:00Z'[39m,
Step #0:     destination: [32m'Bern'[39m,
Step #0:     platform: [32m'7'[39m,
Step #0:     line: [32m'IC 1'[39m
Step #0:   }
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeBoardData[2m > [22m[2mnormalizes arrivals data
Step #0: [22m[39m=== RAW BOARD DATA === {
Step #0:   "station": "Geneva",
Step #0:   "type": "arrivals",
Step #0:   "arrivals": [
Step #0:     {
Step #0:       "time": "2024-01-15T15:00:00Z",
Step #0:       "origin": "Lausanne"
Step #0:     }
Step #0:   ]
Step #0: }
Step #0: === BOARD DATA FIELDS === {
Step #0:   hasStation: [33mtrue[39m,
Step #0:   hasStationName: [33mfalse[39m,
Step #0:   hasPlace: [33mfalse[39m,
Step #0:   hasStopPlace: [33mfalse[39m,
Step #0:   placeName: [90mundefined[39m,
Step #0:   stopPlaceName: [90mundefined[39m,
Step #0:   allKeys: [ [32m'type'[39m, [32m'station'[39m, [32m'arrivals'[39m ]
Step #0: }
Step #0: === NORMALIZED BOARD DATA === {
Step #0:   type: [32m'arrivals'[39m,
Step #0:   station: [32m'Geneva'[39m,
Step #0:   connectionCount: [33m1[39m,
Step #0:   firstConnection: { time: [32m'2024-01-15T15:00:00Z'[39m, origin: [32m'Lausanne'[39m }
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeBoardData[2m > [22m[2mextracts connections from departures field
Step #0: [22m[39m=== RAW BOARD DATA === {
Step #0:   "stationName": "Basel SBB",
Step #0:   "departures": [
Step #0:     {
Step #0:       "time": "14:00",
Step #0:       "destination": "Zurich"
Step #0:     },
Step #0:     {
Step #0:       "time": "14:15",
Step #0:       "destination": "Bern"
Step #0:     }
Step #0:   ]
Step #0: }
Step #0: === BOARD DATA FIELDS === {
Step #0:   hasStation: [33mfalse[39m,
Step #0:   hasStationName: [33mtrue[39m,
Step #0:   hasPlace: [33mfalse[39m,
Step #0:   hasStopPlace: [33mfalse[39m,
Step #0:   placeName: [90mundefined[39m,
Step #0:   stopPlaceName: [90mundefined[39m,
Step #0:   allKeys: [ [32m'stationName'[39m, [32m'departures'[39m ]
Step #0: }
Step #0: === NORMALIZED BOARD DATA === {
Step #0:   type: [32m'departures'[39m,
Step #0:   station: [32m'Basel SBB'[39m,
Step #0:   connectionCount: [33m2[39m,
Step #0:   firstConnection: { time: [32m'14:00'[39m, destination: [32m'Zurich'[39m }
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-ECONNREFUSED
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-RATE_LIMIT_EXCEEDED
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeBoardData[2m > [22m[2mextracts connections from events field
Step #0: [22m[39m=== RAW BOARD DATA === {
Step #0:   "station": "Lucerne",
Step #0:   "events": [
Step #0:     {
Step #0:       "time": "16:00",
Step #0:       "destination": "Interlaken"
Step #0:     }
Step #0:   ]
Step #0: }
Step #0: === BOARD DATA FIELDS === {
Step #0:   hasStation: [33mtrue[39m,
Step #0:   hasStationName: [33mfalse[39m,
Step #0:   hasPlace: [33mfalse[39m,
Step #0:   hasStopPlace: [33mfalse[39m,
Step #0:   placeName: [90mundefined[39m,
Step #0:   stopPlaceName: [90mundefined[39m,
Step #0:   allKeys: [ [32m'station'[39m, [32m'events'[39m ]
Step #0: }
Step #0: === NORMALIZED BOARD DATA === {
Step #0:   type: [32m'departures'[39m,
Step #0:   station: [32m'Lucerne'[39m,
Step #0:   connectionCount: [33m1[39m,
Step #0:   firstConnection: { time: [32m'16:00'[39m, destination: [32m'Interlaken'[39m }
Step #0: }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-RATE_LIMIT_EXCEEDED: {
Step #0:   error: [32m'Network error'[39m,
Step #0:   code: [32m'RATE_LIMIT_EXCEEDED'[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeBoardData[2m > [22m[2mdefaults to departures when type is not specified
Step #0: [22m[39m=== RAW BOARD DATA === {
Step #0:   "station": "St. Gallen",
Step #0:   "connections": []
Step #0: }
Step #0: === BOARD DATA FIELDS === {
Step #0:   hasStation: [33mtrue[39m,
Step #0:   hasStationName: [33mfalse[39m,
Step #0:   hasPlace: [33mfalse[39m,
Step #0:   hasStopPlace: [33mfalse[39m,
Step #0:   placeName: [90mundefined[39m,
Step #0:   stopPlaceName: [90mundefined[39m,
Step #0:   allKeys: [ [32m'station'[39m, [32m'connections'[39m ]
Step #0: }
Step #0: === NORMALIZED BOARD DATA === {
Step #0:   type: [32m'departures'[39m,
Step #0:   station: [32m'St. Gallen'[39m,
Step #0:   connectionCount: [33m0[39m,
Step #0:   firstConnection: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeBoardData[2m > [22m[2muses default station name when not provided
Step #0: [22m[39m=== RAW BOARD DATA === {
Step #0:   "connections": []
Step #0: }
Step #0: === BOARD DATA FIELDS === {
Step #0:   hasStation: [33mfalse[39m,
Step #0:   hasStationName: [33mfalse[39m,
Step #0:   hasPlace: [33mfalse[39m,
Step #0:   hasStopPlace: [33mfalse[39m,
Step #0:   placeName: [90mundefined[39m,
Step #0:   stopPlaceName: [90mundefined[39m,
Step #0:   allKeys: [ [32m'connections'[39m ]
Step #0: }
Step #0: === NORMALIZED BOARD DATA === {
Step #0:   type: [32m'departures'[39m,
Step #0:   station: [32m'Unknown Station'[39m,
Step #0:   connectionCount: [33m0[39m,
Step #0:   firstConnection: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2mnormalizes route comparison data
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === {
Step #0:   "origin": "Zurich",
Step #0:   "destination": "Geneva",
Step #0:   "criteria": "fastest",
Step #0:   "routes": [
Step #0:     {
Step #0:       "id": "route1",
Step #0:       "duration": "PT2H45M",
Step #0:       "transfers": 0,
Step #0:       "departure": "2024-01-15T14:00:00Z",
Step #0:       "arrival": "2024-01-15T16:45:00Z"
Step #0:     }
Step #0:   ]
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2mextracts routes from trips field
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === {
Step #0:   "from": "Bern",
Step #0:   "to": "Lausanne",
Step #0:   "trips": [
Step #0:     {
Step #0:       "duration": "PT1H15M",
Step #0:       "legs": []
Step #0:     }
Step #0:   ]
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2muses params as fallback for origin/destination
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === {
Step #0:   "routes": []
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-RATE_LIMIT_EXCEEDED
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-SERVICE_UNAVAILABLE
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Retrying in 10ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-SERVICE_UNAVAILABLE: {
Step #0:   error: [32m'Network error'[39m,
Step #0:   code: [32m'SERVICE_UNAVAILABLE'[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2mtransforms trip data into route format
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === {
Step #0:   "trips": [
Step #0:     {
Step #0:       "departureTime": "14:00",
Step #0:       "arrivalTime": "16:00",
Step #0:       "summary": {
Step #0:         "duration": "PT2H"
Step #0:       },
Step #0:       "legs": [
Step #0:         {},
Step #0:         {}
Step #0:       ]
Step #0:     }
Step #0:   ]
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2mhandles array input as routes
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === [
Step #0:   {
Step #0:     "id": "r1",
Step #0:     "duration": "PT1H"
Step #0:   },
Step #0:   {
Step #0:     "id": "r2",
Step #0:     "duration": "PT2H"
Step #0:   }
Step #0: ]
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2mincludes analysis when present
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === {
Step #0:   "routes": [],
Step #0:   "analysis": {
Step #0:     "tradeoffs": [
Step #0:       "Faster but more expensive"
Step #0:     ]
Step #0:   }
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/normalizers/__tests__/cardData.test.ts[2m > [22m[2mnormalizers/cardData[2m > [22m[2mnormalizeCompareData[2m > [22m[2mthrows error for invalid input
Step #0: [22m[39m=== RAW MCP COMPARE RESPONSE === null
Step #0: === RAW MCP COMPARE RESPONSE === "string"
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on error codes
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-SERVICE_UNAVAILABLE
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on timeout messages
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on timeout messages
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on timeout messages
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: {
Step #0:   error: [32m'Request timeout occurred'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0:  [32m✓[39m src/lib/normalizers/__tests__/cardData.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 42[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on timeout messages
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on network error messages
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on network error messages
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on network error messages
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould handle non-Error objects
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould retry on network error messages
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: {
Step #0:   error: [32m'Network connection failed'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mwithRetry - Error Handling[2m > [22m[2mshould handle non-Error objects
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: { error: [32m'String error'[39m, code: [90mundefined[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Retrying in 100ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0:  [32m✓[39m src/hooks/__tests__/useChatStorage.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 102[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Attempt 2/3 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-service: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Retrying in 200ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrip Planning Intent[2m > [22m[2mshould detect EN trip planning with entities
Step #0: [22m[39m[intentExtractor] Extracting from: Find trains from Zurich to Bern tomorrow at 10 AM
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: {
Step #0:   origin: [32m'Zurich'[39m,
Step #0:   destination: [32m'Bern'[39m,
Step #0:   date: [32m'tomorrow'[39m,
Step #0:   time: [32m'10 am'[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrip Planning Intent[2m > [22m[2mshould detect DE trip planning with entities
Step #0: [22m[39m[intentExtractor] Extracting from: Züge von Zürich nach Bern morgen um 10 Uhr
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.85[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zürich'[39m, destination: [32m'Bern'[39m, date: [32m'morgen'[39m, time: [32m'10'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrip Planning Intent[2m > [22m[2mshould detect FR trip planning with entities
Step #0: [22m[39m[intentExtractor] Extracting from: Trains de Zurich à Berne demain à 10h
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m, [32m'en'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m4[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, destination: [32m'Berne'[39m, date: [32m'demain'[39m, time: [32m'10'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrip Planning Intent[2m > [22m[2mshould detect IT trip planning with entities
Step #0: [22m[39m[intentExtractor] Extracting from: Treni da Zurigo a Berna domani alle 10
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.85[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurigo'[39m, destination: [32m'Berna'[39m, date: [32m'domani'[39m, time: [32m'10'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrip Planning Intent[2m > [22m[2mshould handle implicit "X to Y" pattern
Step #0: [22m[39m[intentExtractor] Extracting from: Zurich to Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched implicit trip pattern
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: { destination: [32m'Bern'[39m, origin: [32m'Zurich'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mWeather Check Intent[2m > [22m[2mshould detect EN weather check
Step #0: [22m[39m[intentExtractor] Extracting from: What is the weather in Lucerne?
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Lucerne'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mWeather Check Intent[2m > [22m[2mshould detect DE weather check
Step #0: [22m[39m[intentExtractor] Extracting from: Wie ist das Wetter in Luzern?
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Luzern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mWeather Check Intent[2m > [22m[2mshould detect FR weather check
Step #0: [22m[39m[intentExtractor] Extracting from: Quel temps fait-il à Lucerne?
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Lucerne'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mWeather Check Intent[2m > [22m[2mshould detect IT weather check
Step #0: [22m[39m[intentExtractor] Extracting from: Che tempo fa a Lucerna?
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Lucerna'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mStation Search Intent[2m > [22m[2mshould detect EN station search
Step #0: [22m[39m[intentExtractor] Extracting from: Show me departures from Geneva station
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m3[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Geneva Station'[39m, eventType: [32m'departures'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mStation Search Intent[2m > [22m[2mshould detect DE station search
Step #0: [22m[39m[intentExtractor] Extracting from: Zeig mir Abfahrten vom Bahnhof Genf
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m3[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { eventType: [32m'departures'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mStation Search Intent[2m > [22m[2mshould detect FR station search
Step #0: [22m[39m[intentExtractor] Extracting from: Affiche les départs de la gare de Genève
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m5[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'La Gare'[39m, eventType: [32m'departures'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mStation Search Intent[2m > [22m[2mshould detect IT station search
Step #0: [22m[39m[intentExtractor] Extracting from: Mostra le partenze dalla stazione di Ginevra
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m4[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { eventType: [32m'departures'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mStation Search Intent[2m > [22m[2mshould detect arrivals vs departures
Step #0: [22m[39m[intentExtractor] Extracting from: Show departures from Zurich
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m4[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, eventType: [32m'departures'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mStation Search Intent[2m > [22m[2mshould detect arrivals vs departures
Step #0: [22m[39m[intentExtractor] Extracting from: Show arrivals at Zurich
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m4[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, eventType: [32m'arrivals'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrain Formation Intent[2m > [22m[2mshould detect EN train formation
Step #0: [22m[39m[intentExtractor] Extracting from: What is the train formation for IC 815?
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched formation keywords: [33m3[39m
Step #0: [intentExtractor] Final intent: train_formation
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrain Formation Intent[2m > [22m[2mshould detect DE train formation
Step #0: [22m[39m[intentExtractor] Extracting from: Wie ist die Zugformation für IC 815?
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched formation keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: train_formation
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrain Formation Intent[2m > [22m[2mshould detect FR train formation
Step #0: [22m[39m[intentExtractor] Extracting from: Quelle est la composition du train IC 815?
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m, [32m'en'[39m ]
Step #0: [intentExtractor] Matched formation keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: train_formation
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mTrain Formation Intent[2m > [22m[2mshould detect IT train formation
Step #0: [22m[39m[intentExtractor] Extracting from: Qual è la formazione del treno IC 815?
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched formation keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: train_formation
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mLanguage Detection[2m > [22m[2mshould detect German from keywords
Step #0: [22m[39m[intentExtractor] Extracting from: Züge von Zürich nach Bern
Step #0: [intentExtractor] User language: not specified
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zürich'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mLanguage Detection[2m > [22m[2mshould prioritize user language when provided
Step #0: [22m[39m[intentExtractor] Extracting from: train from Zurich to Bern
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m, [32m'en'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mLanguage Detection[2m > [22m[2mshould handle mixed language input
Step #0: [22m[39m[intentExtractor] Extracting from: Züge from Zurich to Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'de'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mLanguage Detection[2m > [22m[2mshould fallback to user language for ambiguous input
Step #0: [22m[39m[intentExtractor] Extracting from: 10:30
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Final intent: general_info
Step #0: [intentExtractor] Confidence: [33m0.55[39m
Step #0: [intentExtractor] Extracted entities: { time: [32m'10:30'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract origin and destination in EN
Step #0: [22m[39m[intentExtractor] Extracting from: Train from Milan to Zurich
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Milan'[39m, destination: [32m'Zurich'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract origin and destination in IT
Step #0: [22m[39m[intentExtractor] Extracting from: Treni da Milano a Zurigo
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Milano'[39m, destination: [32m'Zurigo'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould handle diacritics in place names
Step #0: [22m[39m[intentExtractor] Extracting from: Zürich to Genève
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m, [32m'fr'[39m, [32m'en'[39m ]
Step #0: [intentExtractor] Matched implicit trip pattern
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: { destination: [32m'Genève'[39m, origin: [32m'Zürich'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract date in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Train tomorrow
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.8500000000000001[39m
Step #0: [intentExtractor] Extracted entities: { date: [32m'tomorrow'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract date in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Zug morgen
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.75[39m
Step #0: [intentExtractor] Extracted entities: { date: [32m'morgen'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract date in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Train demain
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m, [32m'en'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.8500000000000001[39m
Step #0: [intentExtractor] Extracted entities: { date: [32m'demain'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract date in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Treno domani
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.75[39m
Step #0: [intentExtractor] Extracted entities: { date: [32m'domani'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract time in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Train at 10:30
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.8500000000000001[39m
Step #0: [intentExtractor] Extracted entities: { time: [32m'10:30'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract time in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Zug um 10:30
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.75[39m
Step #0: [intentExtractor] Extracted entities: { time: [32m'10:30'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract time in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Train à 10h30
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m, [32m'en'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.9000000000000001[39m
Step #0: [intentExtractor] Extracted entities: { destination: [32m'10h30'[39m, time: [32m'10'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract time in multiple languages
Step #0: [22m[39m[intentExtractor] Extracting from: Treno alle 10:30
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.75[39m
Step #0: [intentExtractor] Extracted entities: { time: [32m'10:30'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mConfidence Scoring[2m > [22m[2mshould have higher confidence with multiple keywords
Step #0: [22m[39m[intentExtractor] Extracting from: train
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mConfidence Scoring[2m > [22m[2mshould have higher confidence with multiple keywords
Step #0: [22m[39m[intentExtractor] Extracting from: Find train connection from Zurich to Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m3[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mConfidence Scoring[2m > [22m[2mshould boost confidence when date/time is specified
Step #0: [22m[39m[intentExtractor] Extracting from: train from Zurich to Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mConfidence Scoring[2m > [22m[2mshould boost confidence when date/time is specified
Step #0: [22m[39m[intentExtractor] Extracting from: train from Zurich to Bern tomorrow at 10 AM
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: {
Step #0:   origin: [32m'Zurich'[39m,
Step #0:   destination: [32m'Bern'[39m,
Step #0:   date: [32m'tomorrow'[39m,
Step #0:   time: [32m'10 am'[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mConfidence Scoring[2m > [22m[2mshould cap confidence at 0.95
Step #0: [22m[39m[intentExtractor] Extracting from: Find train connection from Zurich to Bern tomorrow at 10 AM with multiple keywords
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m3[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: {
Step #0:   origin: [32m'Zurich'[39m,
Step #0:   destination: [32m'Bern'[39m,
Step #0:   date: [32m'tomorrow'[39m,
Step #0:   time: [32m'10 am'[39m
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty string
Step #0: [22m[39m[intentExtractor] Extracting from:
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Final intent: general_info
Step #0: [intentExtractor] Confidence: [33m0.5[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very short queries
Step #0: [22m[39m[intentExtractor] Extracting from: Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Final intent: general_info
Step #0: [intentExtractor] Confidence: [33m0.5[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle queries with special characters
Step #0: [22m[39m[intentExtractor] Extracting from: Train from Zürich (HB) to Bern!
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'de'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zürich (hb)'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle abbreviations
Step #0: [22m[39m[intentExtractor] Extracting from: Train from ZH to BE
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched trip keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zh'[39m, destination: [32m'Be'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEdge Cases[2m > [22m[2mshould prioritize station over trip for "train station"
Step #0: [22m[39m[intentExtractor] Extracting from: Show me the train station in Zurich
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m, [32m'fr'[39m ]
Step #0: [intentExtractor] Matched station keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: station_search
Step #0: [intentExtractor] Confidence: [33m0.9[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, eventType: [32m'departures'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle typos gracefully
Step #0: [22m[39m[intentExtractor] Extracting from: Trian from Zurich to Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched implicit trip pattern
Step #0: [intentExtractor] Final intent: trip_planning
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m, destination: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mGeneral Info Intent[2m > [22m[2mshould default to general_info for unclear queries
Step #0: [22m[39m[intentExtractor] Extracting from: Hello, how are you?
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Final intent: general_info
Step #0: [intentExtractor] Confidence: [33m0.5[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mGeneral Info Intent[2m > [22m[2mshould detect help requests
Step #0: [22m[39m[intentExtractor] Extracting from: Can you help me?
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Final intent: general_info
Step #0: [intentExtractor] Confidence: [33m0.5[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/intentExtractor.test.ts[2m > [22m[2mIntent Extractor[2m > [22m[2mGeneral Info Intent[2m > [22m[2mshould detect help requests
Step #0: [22m[39m[intentExtractor] Extracting from: Kannst du mir helfen?
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Final intent: general_info
Step #0: [intentExtractor] Confidence: [33m0.5[39m
Step #0: [intentExtractor] Extracted entities: {}
Step #0:
Step #0:  [32m✓[39m src/lib/llm/context/intentExtractor.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 97[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Attempt 3/3 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply exponential backoff between retries
Step #0: [22m[39m[RetryHandler] Attempt 3 failed for test-service: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-service: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Retrying in 150ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Attempt 2/3 for test-service
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Retrying in 150ms...
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-service: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Attempt 3/3 for test-service
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould cap delay at maxDelay
Step #0: [22m[39m[RetryHandler] Attempt 3 failed for test-service: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-0
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Retrying in 102ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-0: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-0: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-1: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-0
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Retrying in 100ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-1: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-2
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Retrying in 79ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-2: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-2
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-2: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-3
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Retrying in 102ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-3: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/prompts/__tests__/PromptLoader.test.ts[2m > [22m[2mPromptLoader[2m > [22m[2mgetPrompt[2m > [22m[2mreturns null for non-existent prompt
Step #0: [22m[39m[PromptLoader] Prompt not found: mcp/non-existent-prompt
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/prompts/__tests__/PromptLoader.test.ts[2m > [22m[2mPromptLoader[2m > [22m[2mgetPrompt[2m > [22m[2mreturns null for non-existent category
Step #0: [22m[39m[PromptLoader] Category not found: invalid
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/prompts/__tests__/PromptLoader.test.ts[2m > [22m[2mPromptLoader[2m > [22m[2mgetAllPrompts[2m > [22m[2mreturns empty array for non-existent category
Step #0: [22m[39m[PromptLoader] Category not found: invalid
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/prompts/__tests__/PromptLoader.test.ts[2m > [22m[2mPromptLoader[2m > [22m[2mvalidatePrompt[2m > [22m[2mrejects prompt with undeclared variables in template
Step #0: [22m[39m[PromptLoader] Undeclared variable in template: place (prompt: test-prompt)
Step #0:
Step #0:  [32m✓[39m src/lib/llm/prompts/__tests__/PromptLoader.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 25[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-3
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-3: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for test-4
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Retrying in 99ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for test-4: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0:  [32m✓[39m src/lib/__tests__/formatters.test.ts [2m([22m[2m50 tests[22m[2m)[22m[32m 33[2mms[22m[39m
Step #0:  [32m✓[39m src/hooks/__tests__/useRecentSearches.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 68[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for test-4
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mExponential Backoff[2m > [22m[2mshould apply jitter to prevent thundering herd
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for test-4: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for circuit-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for circuit-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for circuit-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for circuit-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for circuit-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for circuit-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for circuit-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for circuit-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for circuit-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould open circuit after failure threshold
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for circuit-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0: [RetryHandler] Circuit breaker opened for circuit-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for block-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for block-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for block-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for block-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for block-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for block-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for block-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for block-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for block-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for block-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0: [RetryHandler] Circuit breaker opened for block-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould block requests when circuit is open
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for block-test: {
Step #0:   error: [32m'Circuit breaker is open for block-test. Service temporarily unavailable.'[39m,
Step #0:   code: [90mundefined[39m,
Step #0:   status: [90mundefined[39m
Step #0: }
Step #0: [RetryHandler] Circuit breaker opened for block-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for halfopen-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for halfopen-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for halfopen-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for halfopen-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for halfopen-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Circuit breaker reset for halfopen-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for halfopen-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for halfopen-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for halfopen-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for halfopen-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould transition to half-open after reset timeout
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for halfopen-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0: [RetryHandler] Circuit breaker opened for halfopen-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for reset-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for reset-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for reset-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for reset-test
Step #0:
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for reset-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for reset-test: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould reset circuit on success
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for reset-test
Step #0:
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for service1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for service1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for service1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for service1
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for service1: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for service1: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for service1: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for service1: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for service1: { error: [32m'Service error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0: [RetryHandler] Circuit breaker opened for service1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for service1
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mCircuit Breaker[2m > [22m[2mshould maintain separate circuit breakers per service
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for service2
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mshould use default configuration
Step #0: [22m[39m[RetryHandler] Attempt 1/3 for config-test
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 1/5 for custom-config
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Retrying in 47ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for custom-config: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mregisterResolver[2m > [22m[2mregisters a custom resolver
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for customTool
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mresolve[2m > [22m[2mapplies matching resolver to params
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for testTool
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mresolve[2m > [22m[2mapplies only the first matching resolver
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for testTool
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mresolve[2m > [22m[2mpasses executeTool function to resolver
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for testTool
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mresolve[2m > [22m[2mhandles resolver errors gracefully
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for testTool
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mdefault resolvers[2m > [22m[2mincludes StationResolver by default
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for getPlaceEvents
Step #0: [StationResolver] Resolving station name "Zurich HB" to UIC code...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mdefault resolvers[2m > [22m[2mincludes StationResolver by default
Step #0: [22m[39m[StationResolver] Resolved "Zurich HB" to UIC code: 8503000
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mdefault resolvers[2m > [22m[2mincludes LocationResolver by default
Step #0: [22m[39m[ToolResolverRegistry] Applying resolver for getWeather
Step #0: [LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts[2m > [22m[2mToolResolverRegistry[2m > [22m[2mdefault resolvers[2m > [22m[2mincludes LocationResolver by default
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: {
Step #0:   lat: [33m47.3769[39m,
Step #0:   lon: [33m8.5417[39m,
Step #0:   place: { centroid: { coordinates: [36m[Array][39m } }
Step #0: }
Step #0: [LocationResolver] Resolved "Zurich" to coordinates: 47.3769, 8.5417
Step #0:
Step #0:  [32m✓[39m src/lib/llm/toolResolvers/__tests__/ToolResolverRegistry.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 18[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mprepares context without parsed intent
Step #0: [22m[39m[ContextPreparationService] Merged intent: {
Step #0:   type: [32m'trip_planning'[39m,
Step #0:   confidence: [33m0.8[39m,
Step #0:   extractedEntities: { origin: [32m'Zurich'[39m, destination: [32m'Bern'[39m }
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mmerges parsed markdown intent with extracted intent
Step #0: [22m[39m[ContextPreparationService] Merged intent: {
Step #0:   type: [32m'trip_planning'[39m,
Step #0:   confidence: [33m0.8[39m,
Step #0:   extractedEntities: {},
Step #0:   preferences: [ [32m'eco-friendly'[39m, [32m'fast'[39m ],
Step #0:   subQueries: [ [32m'What are the connections?'[39m, [32m'How long does it take?'[39m ]
Step #0: }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mhandles parsed intent without markdown flag
Step #0: [22m[39m[ContextPreparationService] Merged intent: { type: [32m'trip_planning'[39m, confidence: [33m0.8[39m, extractedEntities: {} }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mhandles different languages
Step #0: [22m[39m[ContextPreparationService] Merged intent: { type: [32m'trip_planning'[39m, confidence: [33m0.8[39m, extractedEntities: {} }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mhandles different languages
Step #0: [22m[39m[ContextPreparationService] Merged intent: { type: [32m'trip_planning'[39m, confidence: [33m0.8[39m, extractedEntities: {} }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mhandles different languages
Step #0: [22m[39m[ContextPreparationService] Merged intent: { type: [32m'trip_planning'[39m, confidence: [33m0.8[39m, extractedEntities: {} }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts[2m > [22m[2mContextPreparationService[2m > [22m[2mprepareContext[2m > [22m[2mhandles different languages
Step #0: [22m[39m[ContextPreparationService] Merged intent: { type: [32m'trip_planning'[39m, confidence: [33m0.8[39m, extractedEntities: {} }
Step #0:
Step #0:  [32m✓[39m src/lib/llm/orchestrator/services/__tests__/ContextPreparationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 15[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 2/5 for custom-config
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for custom-config: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Retrying in 101ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 3/5 for custom-config
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Retrying in 207ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 3 failed for custom-config: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0:  [32m✓[39m src/lib/llm/orchestrator/services/__tests__/ResponseSynthesisService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 12[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 4/5 for custom-config
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 4 failed for custom-config: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Retrying in 382ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 5/5 for custom-config
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mmerge custom configuration with defaults
Step #0: [22m[39m[RetryHandler] Attempt 5 failed for custom-config: { error: [32m'Temporary network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mshould respect custom retryable errors
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for custom-errors
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mshould respect custom retryable errors
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for custom-errors: { error: [32m'Custom error'[39m, code: [32m'CUSTOM_ERROR'[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mshould respect custom retryable errors
Step #0: [22m[39m[RetryHandler] Retrying in 9ms...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mConfiguration[2m > [22m[2mshould respect custom retryable errors
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for custom-errors
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mUtility Functions[2m > [22m[2mshould reset specific circuit breaker
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for util-test
Step #0: [RetryHandler] Circuit breaker reset for util-test
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mUtility Functions[2m > [22m[2mshould reset specific circuit breaker
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for util-test: { error: [32m'Error'[39m, code: [90mundefined[39m, status: [33m500[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle zero max attempts gracefully
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for zero-attempts
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined error
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for undefined-error
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined error
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for undefined-error: { error: [32m'undefined'[39m, code: [90mundefined[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle null error
Step #0: [22m[39m[RetryHandler] Attempt 1/1 for null-error
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle null error
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for null-error: { error: [32m'null'[39m, code: [90mundefined[39m, status: [90mundefined[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very small delays
Step #0: [22m[39m[RetryHandler] Attempt 1/2 for small-delay
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very small delays
Step #0: [22m[39m[RetryHandler] Retrying in 1ms...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very small delays
Step #0: [22m[39m[RetryHandler] Attempt 1 failed for small-delay: { error: [32m'Network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very small delays
Step #0: [22m[39m[RetryHandler] Attempt 2/2 for small-delay
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/__tests__/retryHandler.test.ts[2m > [22m[2mRetryHandler[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very small delays
Step #0: [22m[39m[RetryHandler] Attempt 2 failed for small-delay: { error: [32m'Network error'[39m, code: [90mundefined[39m, status: [33m503[39m }
Step #0:
Step #0:  [32m✓[39m src/lib/llm/__tests__/retryHandler.test.ts [2m([22m[2m30 tests[22m[2m)[22m[33m 2079[2mms[22m[39m
Step #0:        [33m[2m✓[22m[39m should apply exponential backoff between retries [33m 303[2mms[22m[39m
Step #0:        [33m[2m✓[22m[39m should cap delay at maxDelay [33m 302[2mms[22m[39m
Step #0:        [33m[2m✓[22m[39m should apply jitter to prevent thundering herd [33m 489[2mms[22m[39m
Step #0:        [33m[2m✓[22m[39m merge custom configuration with defaults [33m 744[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mresolves location name to coordinates using GeoJSON centroid
Step #0: [22m[39m[LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mresolves location name to coordinates using GeoJSON centroid
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: {
Step #0:   lat: [33m47.3769[39m,
Step #0:   lon: [33m8.5417[39m,
Step #0:   place: { name: [32m'Zurich'[39m, centroid: { type: [32m'Point'[39m, coordinates: [36m[Array][39m } }
Step #0: }
Step #0: [LocationResolver] Resolved "Zurich" to coordinates: 47.3769, 8.5417
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mresolves location using legacy location object format
Step #0: [22m[39m[LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mresolves location using legacy location object format
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: {
Step #0:   lat: [33m47.3769[39m,
Step #0:   lon: [33m8.5417[39m,
Step #0:   place: {
Step #0:     name: [32m'Zurich'[39m,
Step #0:     location: { latitude: [33m47.3769[39m, longitude: [33m8.5417[39m }
Step #0:   }
Step #0: }
Step #0: [LocationResolver] Resolved "Zurich" to coordinates: 47.3769, 8.5417
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles location parameter instead of locationName
Step #0: [22m[39m[LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles location parameter instead of locationName
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: {
Step #0:   lat: [33m47.3769[39m,
Step #0:   lon: [33m8.5417[39m,
Step #0:   place: { centroid: { coordinates: [36m[Array][39m } }
Step #0: }
Step #0: [LocationResolver] Resolved "Zurich" to coordinates: 47.3769, 8.5417
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when resolution fails
Step #0: [22m[39m[LocationResolver] Resolving location "Unknown Place" to coordinates...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when resolution fails
Step #0: [22m[39m[LocationResolver] Failed to resolve location "Unknown Place" Not found
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when resolution fails
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mfalse[39m, dataLength: [90mundefined[39m, error: [32m'Not found'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when no data is returned
Step #0: [22m[39m[LocationResolver] Resolving location "Unknown Place" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when no data is returned
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m0[39m, error: [90mundefined[39m }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when no data is returned
Step #0: [22m[39m[LocationResolver] Failed to resolve location "Unknown Place" [90mundefined[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when coordinates are missing
Step #0: [22m[39m[LocationResolver] Resolving location "Some Place" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when coordinates are missing
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: { lat: [90mundefined[39m, lon: [90mundefined[39m, place: { name: [32m'Some Place'[39m } }
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when coordinates are missing
Step #0: [22m[39m[LocationResolver] Could not find coordinates for "Some Place"
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles errors gracefully
Step #0: [22m[39m[LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles errors gracefully
Step #0: [22m[39m[LocationResolver] Error resolving location: Error: Network error
Step #0:     at [90m/workspace/[39msrc/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts:160:28
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:145:11
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:26
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
Step #0:     at new Promise (<anonymous>)
Step #0:     at runWithTimeout [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
Step #0:     at Traces.$ [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
Step #0:     at trace [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
Step #0:     at runTest [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mpreserves other parameters
Step #0: [22m[39m[LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mpreserves other parameters
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: {
Step #0:   lat: [33m47.3769[39m,
Step #0:   lon: [33m8.5417[39m,
Step #0:   place: { centroid: { coordinates: [36m[Array][39m } }
Step #0: }
Step #0: [LocationResolver] Resolved "Zurich" to coordinates: 47.3769, 8.5417
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles invalid centroid coordinates
Step #0: [22m[39m[LocationResolver] Resolving location "Zurich" to coordinates...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles invalid centroid coordinates
Step #0: [22m[39m[LocationResolver] Could not find coordinates for "Zurich"
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts[2m > [22m[2mLocationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles invalid centroid coordinates
Step #0: [22m[39m[LocationResolver] findPlaces result: { success: [33mtrue[39m, dataLength: [33m1[39m, error: [90mundefined[39m }
Step #0: [LocationResolver] Extracted coordinates: {
Step #0:   lat: [90mundefined[39m,
Step #0:   lon: [90mundefined[39m,
Step #0:   place: { centroid: { coordinates: [32m'invalid'[39m } }
Step #0: }
Step #0:
Step #0:  [32m✓[39m src/lib/llm/toolResolvers/__tests__/LocationResolver.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 38[2mms[22m[39m
Step #0:  [32m✓[39m src/lib/llm/__tests__/systemPromptHelper.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 47[2mms[22m[39m
Step #0:  [32m✓[39m src/lib/__tests__/i18n.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 18[2mms[22m[39m
Step #0:  [32m✓[39m src/hooks/__tests__/useFavoriteStations.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 92[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mSnow Conditions Intent Detection[2m > [22m[2mshould detect snow_conditions intent for "snow conditions in Zermatt"
Step #0: [22m[39m[intentExtractor] Extracting from: snow conditions in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mSnow Conditions Intent Detection[2m > [22m[2mshould detect snow_conditions intent for "ski conditions in St. Moritz"
Step #0: [22m[39m[intentExtractor] Extracting from: ski conditions in St. Moritz
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'St. Moritz'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mSnow Conditions Intent Detection[2m > [22m[2mshould detect snow_conditions intent for "how much snow in Verbier"
Step #0: [22m[39m[intentExtractor] Extracting from: how much snow in Verbier
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Verbier'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mSnow Conditions Intent Detection[2m > [22m[2mshould detect snow_conditions for German "Schneebedingungen in Zermatt"
Step #0: [22m[39m[intentExtractor] Extracting from: Schneebedingungen in Zermatt
Step #0: [intentExtractor] User language: de
Step #0: [intentExtractor] Detected languages: [ [32m'de'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mSnow Conditions Intent Detection[2m > [22m[2mshould detect snow_conditions for French "conditions de neige à Verbier"
Step #0: [22m[39m[intentExtractor] Extracting from: conditions de neige à Verbier
Step #0: [intentExtractor] User language: fr
Step #0: [intentExtractor] Detected languages: [ [32m'fr'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m3[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Verbier'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mSnow Conditions Intent Detection[2m > [22m[2mshould detect snow_conditions for Italian "condizioni della neve a Zermatt"
Step #0: [22m[39m[intentExtractor] Extracting from: condizioni della neve a Zermatt
Step #0: [intentExtractor] User language: it
Step #0: [intentExtractor] Detected languages: [ [32m'it'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mWeather vs Snow Distinction[2m > [22m[2mshould detect weather_check (NOT snow) for "weather in Zurich"
Step #0: [22m[39m[intentExtractor] Extracting from: weather in Zurich
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zurich'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mWeather vs Snow Distinction[2m > [22m[2mshould detect weather_check for "temperature in Bern"
Step #0: [22m[39m[intentExtractor] Extracting from: temperature in Bern
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mWeather vs Snow Distinction[2m > [22m[2mshould detect weather_check for "will it rain in Geneva"
Step #0: [22m[39m[intentExtractor] Extracting from: will it rain in Geneva
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched weather keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: weather_check
Step #0: [intentExtractor] Confidence: [33m0.7999999999999999[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Geneva'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mWeather vs Snow Distinction[2m > [22m[2mshould detect snow_conditions (NOT weather) for "powder in Zermatt"
Step #0: [22m[39m[intentExtractor] Extracting from: powder in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mWeather vs Snow Distinction[2m > [22m[2mshould detect snow_conditions for "skiing in Davos"
Step #0: [22m[39m[intentExtractor] Extracting from: skiing in Davos
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Davos'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mKeyword Matching[2m > [22m[2mshould match snow keywords for snow queries
Step #0: [22m[39m[intentExtractor] Extracting from: snow conditions in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mKeyword Matching[2m > [22m[2mshould have high confidence for multi-keyword snow queries
Step #0: [22m[39m[intentExtractor] Extracting from: ski resort snow conditions in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m4[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.95[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract location from "in" preposition
Step #0: [22m[39m[intentExtractor] Extracting from: snow in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mEntity Extraction[2m > [22m[2mshould extract location from "at" preposition
Step #0: [22m[39m[intentExtractor] Extracting from: ski conditions at St. Moritz
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'St. Moritz'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mEntity Extraction[2m > [22m[2mshould handle complex location names
Step #0: [22m[39m[intentExtractor] Extracting from: snow conditions in Saas-Fee
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Saas-Fee'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mEdge Cases[2m > [22m[2mshould prioritize snow over weather when both keywords present
Step #0: [22m[39m[intentExtractor] Extracting from: weather and snow conditions in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle "snowfall" as snow_conditions
Step #0: [22m[39m[intentExtractor] Extracting from: snowfall in Zermatt
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m1[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.7[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Zermatt'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/context/__tests__/snowConditionsIntent.test.ts[2m > [22m[2mIntent Extractor - Snow Conditions[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle "slopes" as snow_conditions
Step #0: [22m[39m[intentExtractor] Extracting from: slopes in Verbier
Step #0: [intentExtractor] User language: en
Step #0: [intentExtractor] Detected languages: [ [32m'en'[39m ]
Step #0: [intentExtractor] Matched snow keywords: [33m2[39m
Step #0: [intentExtractor] Final intent: snow_conditions
Step #0: [intentExtractor] Confidence: [33m0.8[39m
Step #0: [intentExtractor] Extracted entities: { origin: [32m'Verbier'[39m }
Step #0:
Step #0:  [32m✓[39m src/lib/llm/context/__tests__/snowConditionsIntent.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 48[2mms[22m[39m
Step #0:  [32m✓[39m src/lib/llm/__tests__/sessionManager.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 42[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mresolves station name to UIC code
Step #0: [22m[39m[StationResolver] Resolving station name "Zurich HB" to UIC code...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mresolves station name to UIC code
Step #0: [22m[39m[StationResolver] Resolved "Zurich HB" to UIC code: 8503000
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2muses uicCode field if id is not present
Step #0: [22m[39m[StationResolver] Resolving station name "Zurich HB" to UIC code...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2muses uicCode field if id is not present
Step #0: [22m[39m[StationResolver] Resolved "Zurich HB" to UIC code: 8503000
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when resolution fails
Step #0: [22m[39m[StationResolver] Resolving station name "Unknown Station" to UIC code...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when resolution fails
Step #0: [22m[39m[StationResolver] Failed to resolve station name "Unknown Station"
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when no data is returned
Step #0: [22m[39m[StationResolver] Resolving station name "Unknown Station" to UIC code...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when no data is returned
Step #0: [22m[39m[StationResolver] Failed to resolve station name "Unknown Station"
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when UIC code is missing
Step #0: [22m[39m[StationResolver] Resolving station name "Some Station" to UIC code...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mreturns original params when UIC code is missing
Step #0: [22m[39m[StationResolver] Could not find UIC code for "Some Station"
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles errors gracefully
Step #0: [22m[39m[StationResolver] Resolving station name "Zurich HB" to UIC code...
Step #0:
Step #0: [90mstderr[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mhandles errors gracefully
Step #0: [22m[39m[StationResolver] Error resolving station: Error: Network error
Step #0:     at [90m/workspace/[39msrc/lib/llm/toolResolvers/__tests__/StationResolver.test.ts:123:28
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:145:11
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:26
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
Step #0:     at new Promise (<anonymous>)
Step #0:     at runWithTimeout [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
Step #0:     at Traces.$ [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
Step #0:     at trace [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
Step #0:     at runTest [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mpreserves other parameters
Step #0: [22m[39m[StationResolver] Resolving station name "Zurich HB" to UIC code...
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts[2m > [22m[2mStationResolver[2m > [22m[2mresolve[2m > [22m[2mpreserves other parameters
Step #0: [22m[39m[StationResolver] Resolved "Zurich HB" to UIC code: 8503000
Step #0:
Step #0:  [32m✓[39m src/lib/llm/toolResolvers/__tests__/StationResolver.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 22[2mms[22m[39m
Step #0:  [32m✓[39m src/lib/llm/functions/__tests__/weatherFunctions.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 9[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2mreturns true when message requires orchestration and has sufficient confidence
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0.8[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2mreturns false when message does not require orchestration
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mfalse[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0.9[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2mreturns false when confidence is below threshold
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0.5[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2muses custom confidence threshold
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0.6[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0: [OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0.6[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.5[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2mhandles edge case: exactly at threshold
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0.7[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2mhandles zero confidence
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m0[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0:
Step #0: [90mstdout[2m | src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts[2m > [22m[2mOrchestrationDecisionService[2m > [22m[2mshouldOrchestrate[2m > [22m[2mhandles perfect confidence
Step #0: [22m[39m[OrchestrationDecisionService] requiresOrchestration: [33mtrue[39m
Step #0: [OrchestrationDecisionService] intent.confidence: [33m1[39m
Step #0: [OrchestrationDecisionService] threshold: [33m0.7[39m
Step #0:
Step #0:  [32m✓[39m src/lib/llm/orchestrator/services/__tests__/OrchestrationDecisionService.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 9[2mms[22m[39m
Step #0: [90mstdout[2m | src/lib/translation/translationService.test.ts[2m > [22m[2mTranslation Service[2m > [22m[2mtranslateToEnglish[2m > [22m[2mshould translate Chinese to English
Step #0: [22m[39m[Translation] zh → en: { original: [32m'从苏黎世到伯尔尼的火车'[39m, translated: [32m'Trains from Zurich to Bern'[39m }
Step #0:
Step #0: [90mstdout[2m | src/lib/translation/translationService.test.ts[2m > [22m[2mTranslation Service[2m > [22m[2mtranslateToEnglish[2m > [22m[2mshould translate Hindi to English
Step #0: [22m[39m[Translation] hi → en: {
Step #0:   original: [32m'ज्यूरिख से बर्न तक ट्रेनें'[39m,
Step #0:   translated: [32m'Trains from Zurich to Bern'[39m
Step #0: }
Step #0:
Step #0: [90mstderr[2m | src/lib/translation/translationService.test.ts[2m > [22m[2mTranslation Service[2m > [22m[2mtranslateToEnglish[2m > [22m[2mshould return original text if no API key configured
Step #0: [22m[39m[Translation] Google Cloud API key not configured, skipping translation
Step #0:
Step #0: [90mstdout[2m | src/lib/translation/translationService.test.ts[2m > [22m[2mTranslation Service[2m > [22m[2mtranslateToEnglish[2m > [22m[2mshould handle translation errors gracefully
Step #0: [22m[39m[Translation] zh → en: { original: [32m'test query'[39m, translated: [32m'Trains from Zurich to Bern'[39m }
Step #0:
Step #0:  [32m✓[39m src/lib/translation/translationService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 10[2mms[22m[39m
Step #0: [90mstderr[2m | src/__tests__/lib/mapUtils.test.ts[2m > [22m[2mextractTripCoordinates[2m > [22m[2mshould return empty array for undefined trip
Step #0: [22m[39m[extractTripCoordinates] Failed to extract coordinates TypeError: Cannot read properties of undefined (reading 'legs')
Step #0:     at extractTripCoordinates [90m(/workspace/[39msrc/lib/mapUtils.ts:8:15[90m)[39m
Step #0:     at [90m/workspace/[39msrc/__tests__/lib/mapUtils.test.ts:7:12
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:145:11
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:26
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
Step #0:     at new Promise (<anonymous>)
Step #0:     at runWithTimeout [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
Step #0:     at Traces.$ [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
Step #0:     at trace [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
Step #0: [MAP] Error extracting coordinates: TypeError: Cannot read properties of undefined (reading 'legs')
Step #0:     at extractTripCoordinates [90m(/workspace/[39msrc/lib/mapUtils.ts:8:15[90m)[39m
Step #0:     at [90m/workspace/[39msrc/__tests__/lib/mapUtils.test.ts:7:12
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:145:11
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:26
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
Step #0:     at new Promise (<anonymous>)
Step #0:     at runWithTimeout [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
Step #0:     at [90mfile:///workspace/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
Step #0:     at Traces.$ [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
Step #0:     at trace [90m(file:///workspace/[39mnode_modules/[4m.pnpm[24m/vitest@4.0.16_@types+node@25.0.3_@vitest+browser-playwright@4.0.16_jiti@2.6.1_jsdom@27.4.0_lightningcss@1.30.2/node_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
Step #0:
Step #0: [90mstderr[2m | src/__tests__/lib/mapUtils.test.ts[2m > [22m[2mextractTripCoordinates[2m > [22m[2mshould return empty array for empty object
Step #0: [22m[39m[extractTripCoordinates] No legs found in trip data
Step #0: [MAP] No legs found in trip data
Step #0:
Step #0: [90mstdout[2m | src/__tests__/lib/mapUtils.test.ts[2m > [22m[2mextractTripCoordinates[2m > [22m[2mshould return correct coordinates for trip with stops
Step #0: [22m[39m[MAP] Extracting coordinates from trip with [33m1[39m legs
Step #0: [MAP] Processing leg 0: { serviceJourney: { stopPoints: [ [36m[Object][39m, [36m[Object][39m ] } }
Step #0: [MAP] Found 2 stop points in leg 0
Step #0: [MAP] Extracted coords from stop 0: [ [33m46.948[39m, [33m7.4474[39m ]
Step #0: [MAP] Extracted coords from stop 1: [ [33m47.3769[39m, [33m8.5417[39m ]
Step #0: [MAP] Extracted 2 unique coordinate points from 2 total points
Step #0:
Step #0: [90mstdout[2m | src/__tests__/lib/mapUtils.test.ts[2m > [22m[2mextractTripCoordinates[2m > [22m[2mshould fallback to leg start/end if serviceJourney missing
Step #0: [22m[39m[MAP] Extracting coordinates from trip with [33m1[39m legs
Step #0: [MAP] Processing leg 0: {
Step #0:   departure: { place: { latitude: [33m46.948[39m, longitude: [33m7.4474[39m } },
Step #0:   arrival: { place: { latitude: [33m47.3769[39m, longitude: [33m8.5417[39m } }
Step #0: }
Step #0: [MAP] No stopPoints, trying fallback extraction for leg 0
Step #0: [MAP] Extracted start coords from leg 0: [ [33m46.948[39m, [33m7.4474[39m ]
Step #0: [MAP] Extracted end coords from leg 0: [ [33m47.3769[39m, [33m8.5417[39m ]
Step #0: [MAP] Extracted 2 unique coordinate points from 2 total points
Step #0:
Step #0: [90mstdout[2m | src/__tests__/lib/mapUtils.test.ts[2m > [22m[2mextractTripCoordinates[2m > [22m[2mshould extract coordinates from GeoJSON format (SBB API)
Step #0: [22m[39m[MAP] Extracting coordinates from trip with [33m1[39m legs
Step #0: [MAP] Processing leg 0: { serviceJourney: { stopPoints: [ [36m[Object][39m, [36m[Object][39m ] } }
Step #0: [MAP] Found 2 stop points in leg 0
Step #0: [MAP] Found centroid GeoJSON coordinates: [lon: 7.4474, lat: 46.948] -> [lat: 46.948, lon: 7.4474]
Step #0: [MAP] Extracted coords from stop 0: [ [33m46.948[39m, [33m7.4474[39m ]
Step #0: [MAP] Found centroid GeoJSON coordinates: [lon: 8.5417, lat: 47.3769] -> [lat: 47.3769, lon: 8.5417]
Step #0: [MAP] Extracted coords from stop 1: [ [33m47.3769[39m, [33m8.5417[39m ]
Step #0: [MAP] Extracted 2 unique coordinate points from 2 total points
Step #0:
Step #0:  [32m✓[39m src/__tests__/lib/mapUtils.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 17[2mms[22m[39m
Step #0:  [32m✓[39m src/__tests__/hooks/useSavedTrips.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 28[2mms[22m[39m
Step #0: [90mstdout[2m | src/__tests__/context/SettingsContext.test.tsx[2m > [22m[2mSettingsContext[2m > [22m[2mshould provide default settings
Step #0: [22m[39m[SettingsContext] Applying theme: { theme: [32m'system'[39m, isDark: [33mfalse[39m }
Step #0:
Step #0: [90mstdout[2m | src/__tests__/context/SettingsContext.test.tsx[2m > [22m[2mSettingsContext[2m > [22m[2mshould update settings
Step #0: [22m[39m[SettingsContext] Applying theme: { theme: [32m'system'[39m, isDark: [33mfalse[39m }
Step #0: [SettingsContext] Applying theme: { theme: [32m'dark'[39m, isDark: [33mtrue[39m }
Step #0:
Step #0:  [32m✓[39m src/__tests__/context/SettingsContext.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 25[2mms[22m[39m
Step #0:
Step #0: [2m Test Files [22m [1m[32m26 passed[39m[22m[90m (26)[39m
Step #0: [2m      Tests [22m [1m[32m458 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (459)[39m
Step #0: [2m   Start at [22m 16:04:34
Step #0: [2m   Duration [22m 5.50s[2m (transform 1.85s, setup 2.17s, import 3.89s, tests 2.98s, environment 19.95s)[22m
Step #0:
Finished Step #0
Starting Step #1
Step #1: Already have image (with digest): gcr.io/cloud-builders/docker
Step #1: Sending build context to Docker daemon  771.1MB
Step #1: Step 1/28 : FROM node:24-alpine AS base
Step #1: 24-alpine: Pulling from library/node
Step #1: 1074353eec0d: Pulling fs layer
Step #1: 992d5d86cfde: Pulling fs layer
Step #1: 097af512c3b2: Pulling fs layer
Step #1: eedec57bd66a: Pulling fs layer
Step #1: eedec57bd66a: Download complete
Step #1: 097af512c3b2: Verifying Checksum
Step #1: 097af512c3b2: Download complete
Step #1: 1074353eec0d: Verifying Checksum
Step #1: 1074353eec0d: Download complete
Step #1: 1074353eec0d: Pull complete
Step #1: 992d5d86cfde: Verifying Checksum
Step #1: 992d5d86cfde: Download complete
Step #1: 992d5d86cfde: Pull complete
Step #1: 097af512c3b2: Pull complete
Step #1: eedec57bd66a: Pull complete
Step #1: Digest: sha256:c921b97d4b74f51744057454b306b418cf693865e73b8100559189605f6955b8
Step #1: Status: Downloaded newer image for node:24-alpine
Step #1:  ---> 63277db82ca1
Step #1: Step 2/28 : FROM base AS deps
Step #1:  ---> 63277db82ca1
Step #1: Step 3/28 : RUN apk add --no-cache libc6-compat
Step #1:  ---> Running in 6be9c459952f
Step #1: (1/3) Installing musl-obstack (1.2.3-r2)
Step #1: (2/3) Installing libucontext (1.3.3-r0)
Step #1: (3/3) Installing gcompat (1.1.0-r4)
Step #1: OK: 11.0 MiB in 21 packages
Step #1: Removing intermediate container 6be9c459952f
Step #1:  ---> 3e3663761fca
Step #1: Step 4/28 : WORKDIR /app
Step #1:  ---> Running in 8b2c8c948004
Step #1: Removing intermediate container 8b2c8c948004
Step #1:  ---> 3d8776773a4b
Step #1: Step 5/28 : RUN corepack enable && corepack prepare pnpm@latest --activate
Step #1:  ---> Running in a20edb6336ca
Step #1: Preparing pnpm@latest for immediate activation...
Step #1: Removing intermediate container a20edb6336ca
Step #1:  ---> a3430e3474f3
Step #1: Step 6/28 : COPY package.json pnpm-lock.yaml ./
Step #1:  ---> f615c8b4ead3
Step #1: Step 7/28 : RUN pnpm install --frozen-lockfile
Step #1:  ---> Running in c70c27580c51
Step #1: Lockfile is up to date, resolution step is skipped
Step #1: Progress: resolved 1, reused 0, downloaded 0, added 0
Step #1: Packages: +763
Step #1: ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Step #1: Progress: resolved 763, reused 0, downloaded 134, added 116
Step #1: Progress: resolved 763, reused 0, downloaded 296, added 208
Step #1: Progress: resolved 763, reused 0, downloaded 580, added 476
Step #1: Progress: resolved 763, reused 0, downloaded 763, added 763, done
Step #1:
Step #1: dependencies:
Step #1: + - 0.0.1
Step #1: + @google-cloud/text-to-speech 6.4.0
Step #1: + @google-cloud/translate 9.3.0
Step #1: + @google/generative-ai 0.24.1
Step #1: + @types/leaflet 1.9.21
Step #1: + @types/mdast 4.0.4
Step #1: + leaflet 1.9.4
Step #1: + lucide-react 0.562.0
Step #1: + next 16.1.1
Step #1: + react 19.2.3
Step #1: + react-dom 19.2.3
Step #1: + react-markdown 10.1.0
Step #1: + remark-gfm 4.0.1
Step #1: + remark-parse 11.0.0
Step #1: + resend 6.6.0
Step #1: + unified 11.0.5
Step #1: + unist-util-visit 5.0.0
Step #1: + zod 4.3.4
Step #1:
Step #1: devDependencies:
Step #1: + @chromatic-com/storybook 4.1.3
Step #1: + @playwright/test 1.57.0
Step #1: + @storybook/addon-a11y 10.1.11
Step #1: + @storybook/addon-docs 10.1.11
Step #1: + @storybook/addon-onboarding 10.1.11
Step #1: + @storybook/addon-themes 10.1.11
Step #1: + @storybook/addon-vitest 10.1.11
Step #1: + @storybook/nextjs-vite 10.1.11
Step #1: + @storybook/react 10.1.11
Step #1: + @tailwindcss/postcss 4.1.18
Step #1: + @testing-library/jest-dom 6.9.1
Step #1: + @testing-library/react 16.3.1
Step #1: + @testing-library/user-event 14.6.1
Step #1: + @types/node 25.0.3
Step #1: + @types/react 19.2.7
Step #1: + @types/react-dom 19.2.3
Step #1: + @vitejs/plugin-react 5.1.2
Step #1: + @vitest/browser-playwright 4.0.16
Step #1: + @vitest/coverage-v8 4.0.16
Step #1: + eslint 9.39.2
Step #1: + eslint-config-next 16.1.1
Step #1: + eslint-plugin-storybook 10.1.11
Step #1: + jsdom 27.4.0
Step #1: + playwright 1.57.0
Step #1: + storybook 10.1.11
Step #1: + tailwindcss 4.1.18
Step #1: + tsc 2.0.4
Step #1: + typescript 5.9.3
Step #1: + vite 7.3.0
Step #1: + vitest 4.0.16
Step #1:
Step #1: ╭ Warning ─────────────────────────────────────────────────────────────────────╮
Step #1: │                                                                              │
Step #1: │   Ignored build scripts: esbuild@0.27.2, protobufjs@7.5.4, sharp@0.34.5,     │
Step #1: │   unrs-resolver@1.11.1.                                                      │
Step #1: │   Run "pnpm approve-builds" to pick which dependencies should be allowed     │
Step #1: │   to run scripts.                                                            │
Step #1: │                                                                              │
Step #1: ╰──────────────────────────────────────────────────────────────────────────────╯
Step #1: Done in 5.1s using pnpm v10.27.0
Step #1: Removing intermediate container c70c27580c51
Step #1:  ---> 575568bea395
Step #1: Step 8/28 : FROM base AS builder
Step #1:  ---> 63277db82ca1
Step #1: Step 9/28 : WORKDIR /app
Step #1:  ---> Running in f5d3ac29d135
Step #1: Removing intermediate container f5d3ac29d135
Step #1:  ---> e486de8ba51a
Step #1: Step 10/28 : RUN corepack enable && corepack prepare pnpm@latest --activate
Step #1:  ---> Running in 92d87a40b33c
Step #1: Preparing pnpm@latest for immediate activation...
Step #1: Removing intermediate container 92d87a40b33c
Step #1:  ---> 40f110c8fd12
Step #1: Step 11/28 : COPY --from=deps /app/node_modules ./node_modules
Step #1:  ---> ec0338190a68
Step #1: Step 12/28 : COPY . .
Step #1:  ---> 4765f81563af
Step #1: Step 13/28 : ENV NEXT_TELEMETRY_DISABLED=1
Step #1:  ---> Running in eb6007a6dbc1
Step #1: Removing intermediate container eb6007a6dbc1
Step #1:  ---> 8112e0b18da9
Step #1: Step 14/28 : RUN pnpm run build
Step #1:  ---> Running in 0be4d7bf9208
Step #1:
Step #1: > sbb-travel-companion@0.9.0 build /app
Step #1: > next build
Step #1:
Step #1: ▲ Next.js 16.1.1 (Turbopack)
Step #1:
Step #1:   Creating an optimized production build ...
Step #1: ✓ Compiled successfully in 33.2s
Step #1:   Running TypeScript ...
Step #1: [91mFailed to compile.
Step #1:
Step #1: [0m[91m./src/components/cards/CompareCard.stories.tsx:31:9
Step #1: Type error: Type '{ id: string; duration: string; transfers: number; price: number; co2: number; score: number; occupancy: string; }' is missing the following properties from type 'ComparisonRoute': name, departure, arrival
Step #1:
Step #1: [0m [90m 29 |[39m       criteria[33m:[39m [32m'fastest'[39m[33m,[39m
Step #1:  [90m 30 |[39m       routes[33m:[39m [
Step #1: [31m[1m>[22m[39m[90m 31 |[39m         {
Step #1:  [90m    |[39m         [31m[1m^[22m[39m
Step #1:  [90m 32 |[39m           id[33m:[39m [32m'1'[39m[33m,[39m
Step #1:  [90m 33 |[39m           duration[33m:[39m [32m'57min'[39m[33m,[39m
Step #1:  [90m 34 |[39m           transfers[33m:[39m [35m0[39m[33m,[39m[0m
Step #1: [0m[91mNext.js build worker exited with code: 1 and signal: null
Step #1: [0m ELIFECYCLE  Command failed with exit code 1.
Step #1: The command '/bin/sh -c pnpm run build' returned a non-zero code: 1
Finished Step #1
ERROR
ERROR: build step 1 "gcr.io/cloud-builders/docker" failed: step exited with non-zero status: 1
---------------------------------------------------------------------------
